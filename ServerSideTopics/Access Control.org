:PROPERTIES:
:ID:       b67c286d-5a99-4ccc-b45c-91948957095d
:END:
#+title: Access Control
#+created: [2025-10-01 Wed 12:27]
#+filetags: :cyber::access-control:
* Access control vulnerabilities and privilege escalation
In this section, we describe:

Privilege escalation.
The types of vulnerabilities that can arise with access control.
How to prevent access control vulnerabilities.
* What is access control?
Access control is the application of constraints on who or what is authorized to perform actions or access resources. In the context of web applications, access control is dependent on authentication and session management:

Authentication confirms that the user is who they say they are.
Session management identifies which subsequent HTTP requests are being made by that same user.
Access control determines whether the user is allowed to carry out the action that they are attempting to perform.
Broken access controls are common and often present a critical security vulnerability. Design and management of access controls is a complex and dynamic problem that applies business, organizational, and legal constraints to a technical implementation. Access control design decisions have to be made by humans so the potential for errors is high.
** Vertical access controls
Vertical access controls are mechanisms that restrict access to sensitive functionality to specific types of users.

With vertical access controls, different types of users have access to different application functions. For example, an administrator might be able to modify or delete any user's account, while an ordinary user has no access to these actions. Vertical access controls can be more fine-grained implementations of security models designed to enforce business policies such as separation of duties and least privilege.
** Horizontal access controls
Horizontal access controls are mechanisms that restrict access to resources to specific users.

With horizontal access controls, different users have access to a subset of resources of the same type. For example, a banking application will allow a user to view transactions and make payments from their own accounts, but not the accounts of any other user.
** Context-dependent access controls
Context-dependent access controls restrict access to functionality and resources based upon the state of the application or the user's interaction with it.

Context-dependent access controls prevent a user performing actions in the wrong order. For example, a retail website might prevent users from modifying the contents of their shopping cart after they have made payment.
* Examples of broken access controls
Broken access control vulnerabilities exist when a user can access resources or perform actions that they are not supposed to be able to.
** Vertical privilege escalation
If a user can gain access to functionality that they are not permitted to access then this is vertical privilege escalation. For example, if a non-administrative user can gain access to an admin page where they can delete user accounts, then this is vertical privilege escalation
** Unprotected functionality
At its most basic, vertical privilege escalation arises where an application does not enforce any protection for sensitive functionality. For example, administrative functions might be linked from an administrator's welcome page but not from a user's welcome page. However, a user might be able to access the administrative functions by browsing to the relevant admin URL.

For example, a website might host sensitive functionality at the following URL:

https://insecure-website.com/admin
This might be accessible by any user, not only administrative users who have a link to the functionality in their user interface. In some cases, the administrative URL might be disclosed in other locations, such as the robots.txt file:

https://insecure-website.com/robots.txt
Even if the URL isn't disclosed anywhere, an attacker may be able to use a wordlist to brute-force the location of the sensitive functionality.
*** Lab: Unprotected admin functionality
APPRENTICE

LAB
Solved
This lab has an unprotected admin panel.

Solve the lab by deleting the user carlos.

- solution:
  I checked the robots.txt file, and there was an admin panel page, went to it and it didn't check anything.
** Continued
In some cases, sensitive functionality is concealed by giving it a less predictable URL. This is an example of so-called "security by obscurity". However, hiding sensitive functionality does not provide effective access control because users might discover the obfuscated URL in a number of ways.

Imagine an application that hosts administrative functions at the following URL:

https://insecure-website.com/administrator-panel-yb556
This might not be directly guessable by an attacker. However, the application might still leak the URL to users. The URL might be disclosed in JavaScript that constructs the user interface based on the user's role:

<script>
	var isAdmin = false;
	if (isAdmin) {
		...
		var adminPanelTag = document.createElement('a');
		adminPanelTag.setAttribute('href', 'https://insecure-website.com/administrator-panel-yb556');
		adminPanelTag.innerText = 'Admin panel';
		...
	}
</script>
This script adds a link to the user's UI if they are an admin user. However, the script containing the URL is visible to all users regardless of their role.
*** Lab: Unprotected admin functionality with unpredictable URL
APPRENTICE

LAB
Solved
This lab has an unprotected admin panel. It's located at an unpredictable location, but the location is disclosed somewhere in the application.

Solve the lab by accessing the admin panel, and using it to delete the user carlos.

- solution:
  checked the source code there was a script tag that gave the url of the admin page.
** Parameter-based access control methods
Some applications determine the user's access rights or role at login, and then store this information in a user-controllable location. This could be:

A hidden field.
A cookie.
A preset query string parameter.
The application makes access control decisions based on the submitted value. For example:

https://insecure-website.com/login/home.jsp?admin=true
https://insecure-website.com/login/home.jsp?role=1
This approach is insecure because a user can modify the value and access functionality they're not authorized to, such as administrative functions.
*** Lab: User role controlled by request parameter
APPRENTICE

LAB
Solved
This lab has an admin panel at /admin, which identifies administrators using a forgeable cookie.

Solve the lab by accessing the admin panel and using it to delete the user carlos.

You can log in to your own account using the following credentials: wiener:peter

- solution:
  once logged in I got a cookie called IsAdmin, and it was set to false -_-.
  I just set it true, went to the admin page, deleted carlos.
*** Lab: User role can be modified in user profile
APPRENTICE

LAB
Solved
This lab has an admin panel at /admin. It's only accessible to logged-in users with a roleid of 2.

Solve the lab by accessing the admin panel and using it to delete the user carlos.

You can log in to your own account using the following credentials: wiener:peter
- solution:
  this one was a bit harder; I had to update my email address and study the response. It responded with a JSON of all my accounts' attributes, so I resubmitted the email with the additional parameter roleid=2.
  this went through fine, then I could access the admin panel
** Broken access control resulting from platform misconfiguration
Some applications enforce access controls at the platform layer. they do this by restricting access to specific URLs and HTTP methods based on the user's role. For example, an application might configure a rule as follows:

DENY: POST, /admin/deleteUser, managers
This rule denies access to the POST method on the URL /admin/deleteUser, for users in the managers group. Various things can go wrong in this situation, leading to access control bypasses.

Some application frameworks support various non-standard HTTP headers that can be used to override the URL in the original request, such as X-Original-URL and X-Rewrite-URL. If a website uses rigorous front-end controls to restrict access based on the URL, but the application allows the URL to be overridden via a request header, then it might be possible to bypass the access controls using a request like the following:

POST / HTTP/1.1
X-Original-URL: /admin/deleteUser
...
An alternative attack relates to the HTTP method used in the request. The front-end controls described in the previous sections restrict access based on the URL and HTTP method. Some websites tolerate different HTTP request methods when performing an action. If an attacker can use the GET (or another) method to perform actions on a restricted URL, they can bypass the access control that is implemented at the platform layer.


*** Lab: URL-based access control can be circumvented
PRACTITIONER

LAB
Solved
This website has an unauthenticated admin panel at /admin, but a front-end system has been configured to block external access to that path. However, the back-end application is built on a framework that supports the X-Original-URL header.

To solve the lab, access the admin panel and delete the user carlos.

- solution:
  I had to use the x-original-url header to set the url to /admin, I could then delete carlos by putting in the GET parameter while changing the original url to /admin/delete
**** deep seek explanation:
1. Initial Observation
You try GET /admin â†’ get blocked with a plain response

This suggests a front-end system (like a WAF, load balancer, or security filter) is blocking the request before it reaches the main application

2. The Hypothesis
You suspect the infrastructure might use X-Original-URL for internal routing. But you need to test this hypothesis.

3. The Critical Test
http
GET / HTTP/1.1
Host: target.com
X-Original-URL: /invalid
4. Why the "Not Found" Response is Significant
If the header was being ignored, you'd get one of these responses:

The home page (from GET /)

The same blocking page as before

An error about invalid headers

But instead, you get a "not found" response for /invalid - this tells you:

The back-end processed your header: It looked at X-Original-URL: /invalid and tried to find that endpoint

The route doesn't exist: /invalid isn't a real page in the application

Proof of concept: The system is definitely using the header for routing decisions

*** Lab: Method-based access control can be circumvented
PRACTITIONER

LAB
Solved
This lab implements access controls based partly on the HTTP method of requests. You can familiarize yourself with the admin panel by logging in using the credentials administrator:admin.

To solve the lab, log in using the credentials wiener:peter and exploit the flawed access controls to promote yourself to become an administrator.
- solution:
  this one was okay, I logged in as admin, went to the admin panel and saw that upgrading user accesses were happening with POST. so I logged out, logged into wiener, and used the same url but passed the variables as GET variables. this worked!
** Broken access control resulting from URL-matching discrepancies
Websites can vary in how strictly they match the path of an incoming request to a defined endpoint. For example, they may tolerate inconsistent capitalization, so a request to /ADMIN/DELETEUSER may still be mapped to the /admin/deleteUser endpoint. If the access control mechanism is less tolerant, it may treat these as two different endpoints and fail to enforce the correct restrictions as a result.

Similar discrepancies can arise if developers using the Spring framework have enabled the useSuffixPatternMatch option. This allows paths with an arbitrary file extension to be mapped to an equivalent endpoint with no file extension. In other words, a request to /admin/deleteUser.anything would still match the /admin/deleteUser pattern. Prior to Spring 5.3, this option is enabled by default.

On other systems, you may encounter discrepancies in whether /admin/deleteUser and /admin/deleteUser/ are treated as distinct endpoints. In this case, you may be able to bypass access controls by appending a trailing slash to the path.
** Horizontal privilege escalation
Horizontal privilege escalation occurs if a user is able to gain access to resources belonging to another user, instead of their own resources of that type. For example, if an employee can access the records of other employees as well as their own, then this is horizontal privilege escalation.

Horizontal privilege escalation attacks may use similar types of exploit methods to vertical privilege escalation. For example, a user might access their own account page using the following URL:

https://insecure-website.com/myaccount?id=123
If an attacker modifies the id parameter value to that of another user, they might gain access to another user's account page, and the associated data and functions.

Note
This is an example of an insecure direct object reference (IDOR) vulnerability. This type of vulnerability arises where user-controller parameter values are used to access resources or functions directly.
*** Lab: User ID controlled by request parameter
APPRENTICE

LAB
Solved
This lab has a horizontal privilege escalation vulnerability on the user account page.

To solve the lab, obtain the API key for the user carlos and submit it as the solution.

You can log in to your own account using the following credentials: wiener:peter

- solution:
  I just changed the GET parameter in the url from wiener to carlos, on the account page.
** Continued
In some applications, the exploitable parameter does not have a predictable value. For example, instead of an incrementing number, an application might use globally unique identifiers (GUIDs) to identify users. This may prevent an attacker from guessing or predicting another user's identifier. However, the GUIDs belonging to other users might be disclosed elsewhere in the application where users are referenced, such as user messages or reviews.
*** Lab: User ID controlled by request parameter, with unpredictable user IDs
APPRENTICE

LAB
Solved
This lab has a horizontal privilege escalation vulnerability on the user account page, but identifies users with GUIDs.

To solve the lab, find the GUID for carlos, then submit his API key as the solution.

You can log in to your own account using the following credentials: wiener:peter

- solution:
  the blog posts had authors, one was carlos, it had a link to his account, this link contained his guid. I used that on the my account page to get his details.
*** Lab: Insecure direct object references:
- solution: the server stored the chat logs within a publicly accessible space, so I just edited the url from 3.txt to 1.txt and carlos had given the support person his psswrd in a chat.
** Access control vulnerabilities in multi-step processes
Many websites implement important functions over a series of steps. This is common when:

A variety of inputs or options need to be captured.
The user needs to review and confirm details before the action is performed.
For example, the administrative function to update user details might involve the following steps:

Load the form that contains details for a specific user.
Submit the changes.
Review the changes and confirm.
Sometimes, a website will implement rigorous access controls over some of these steps, but ignore others. Imagine a website where access controls are correctly applied to the first and second steps, but not to the third step. The website assumes that a user will only reach step 3 if they have already completed the first steps, which are properly controlled. An attacker can gain unauthorized access to the function by skipping the first two steps and directly submitting the request for the third step with the required parameters.
*** Lab: Multi-step process with no access control on one step
PRACTITIONER

LAB
Solved
This lab has an admin panel with a flawed multi-step process for changing a user's role. You can familiarize yourself with the admin panel by logging in using the credentials administrator:admin.

To solve the lab, log in using the credentials wiener:peter and exploit the flawed access controls to promote yourself to become an administrator.

- solution:
  I needed to see that the confirmation POST could be sent by anyone as long as they had an active session cookie.
** Referer-based access control
Some websites base access controls on the Referer header submitted in the HTTP request. The Referer header can be added to requests by browsers to indicate which page initiated a request.

For example, an application robustly enforces access control over the main administrative page at /admin, but for sub-pages such as /admin/deleteUser only inspects the Referer header. If the Referer header contains the main /admin URL, then the request is allowed.

In this case, the Referer header can be fully controlled by an attacker. This means that they can forge direct requests to sensitive sub-pages by supplying the required Referer header, and gain unauthorized access.
*** Lab: Referer-based access control
PRACTITIONER

LAB
Solved
This lab controls access to certain admin functionality based on the Referer header. You can familiarize yourself with the admin panel by logging in using the credentials administrator:admin.

To solve the lab, log in using the credentials wiener:peter and exploit the flawed access controls to promote yourself to become an administrator.
** Location-based access control

Some websites enforce access controls based on the user's geographical location. This can apply, for example, to banking applications or media services where state legislation or business restrictions apply. These access controls can often be circumvented by the use of web proxies, VPNs, or manipulation of client-side geolocation mechanisms.
How to prevent access control vulnerabilities

Access control vulnerabilities can be prevented by taking a defense-in-depth approach and applying the following principles:

    Never rely on obfuscation alone for access control.
    Unless a resource is intended to be publicly accessible, deny access by default.
    Wherever possible, use a single application-wide mechanism for enforcing access controls.
    At the code level, make it mandatory for developers to declare the access that is allowed for each resource, and deny access by default.
    Thoroughly audit and test access controls to ensure they work as designed.
